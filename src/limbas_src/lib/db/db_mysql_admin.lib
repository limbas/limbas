<?php
/**
 * @copyright Limbas GmbH <https://limbas.com>
 * @license https://opensource.org/licenses/GPL-2.0 GPL-2.0
 *
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 */



############# Domain Tables ########################

use Limbas\lib\db\functions\Dbf;
use Limbas\lib\general\Log\Log;

$DBA["DOMAINTABLE"] = array("STATISTICS","KEY_COLUMN_USAGE","TABLES","COLUMNS","TRIGGERS","VIEWS");
$DBA["DOMAINSCHEMA"] = array("INFORMATION_SCHEMA","INFORMATION_SCHEMA","INFORMATION_SCHEMA","INFORMATION_SCHEMA","INFORMATION_SCHEMA","INFORMATION_SCHEMA");

/**
 * db version
 *
 * @param $DBA
 * @return array
 *
 * @deprecated Use Dbf::version instead.
 */
function dbf_version($DBA=null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::version instead.');
	return Dbf::version($DBA);
}

############# indexes ########################

/**
 * existing indexes
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=indexname, [3]=no primary, [4]=fieldname
 * @return string sql
 * @deprecated Use Dbf::getIndicesSql instead.
 */
function dbq_2($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getIndicesSql instead.');
	return Dbf::getIndicesSql($p[0], $p[2] ?? null, $p[1] ?? null, $p[4] ?? null, $p[3] ?? false);
}

/**
 * create index
 *
 * @param array $p [0]=schema, [1]=indexname, [2]=tablename, [3]=fieldname, [4]=unique
 * @return string sql
 * @deprecated Use Dbf::createIndexSql instead.
 */
function dbq_4($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createIndexSql instead.');
	return Dbf::createIndexSql($p[1],$p[2],$p[3],$p[4] ?? false);
}

/**
 * drop index
 *
 * @param array $p [0]=schema, [1]=indexname, [2]=tablename
 * @return string sql
 * @deprecated Use Dbf::dropIndexSql instead.
 */
function dbq_5($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropIndexSql instead.');
	return Dbf::dropIndexSql($p[1], $p[2] ?? '');
}


############# constaints ########################

/**
 * get primary keys
 *
 * @param array $p [0]=schema, [1]=table, [2]=column
 * @deprecated Use Dbf::dropIndexSql instead.
 */
function dbq_23($p=null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getPrimaryKeys instead.');
	return Dbf::getPrimaryKeys($p[0], $p[1], $p[2]);
}

/**
 * get UNIQUE contraints
 *
 * @param array $p [0]=schema, [1]=table, [2]=column
 * @return array
 * @deprecated Use Dbf::dropIndexSql instead.
 */
function dbq_26($p=null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getUniqueConstraints instead.');
	return Dbf::getUniqueConstraints($p[0], $p[1], $p[2]);
}


/**
 * create primary key
 *
 * @param array $p [0]=table, [1]=field
 * @return string sql
 * @deprecated Use Dbf::createPrimaryKeySql instead.
 */
function dbq_17($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createPrimaryKeySql instead.');
	return Dbf::createPrimaryKeySql($p[1], $p[2]);
}


/**
 * create constraint
 *
 * @param array $p [0]=table, [1]=field
 * @return string sql
 * @deprecated Use Dbf::createConstraintSql instead.
 */
function dbq_24($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createConstraintSql instead.');
	return Dbf::createConstraintSql($p[0], $p[1], $p[2]);
}

/**
 * drop primary key
 *
 * @param array $p [0]=table
 * @return string sql
 * @deprecated Use Dbf::dropPrimaryKeySql instead.
 */
function dbq_18($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropPrimaryKeySql instead.');
	return Dbf::dropPrimaryKeySql($p[0]);
}


############# foreign keys ########################

/**
 * get details for foreign keys for specific table or keyname
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=keyname
 * @return string sql
 * @deprecated Use Dbf::getForeignKeySql instead.
 */
function dbq_3($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getForeignKeySql instead.');
	return Dbf::getForeignKeySql($p[0], $p[1], $p[2] ?? null);
}


/**
 * add foreign key
 *
 * @param array $p [0]=parent-tablename, [1]=parent-fieldname, [2]=child-tablename, [3]=child-fieldname, [4]=keyname
 * @return string sql
 * @deprecated Use Dbf::addForeignKeySql instead.
 */
function dbq_11($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::addForeignKeySql instead.');
	return Dbf::addForeignKeySql($p[0], $p[1], $p[2], $p[3], $p[4], $p[5]);
}


/**
 * drop foreign key
 *
 * @param array $p [0]=tablename, [1]=keyname
 * @return string sql
 * @deprecated Use Dbf::dropForeignKeySql instead.
 */
function dbq_6($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropForeignKeySql instead.');
	return Dbf::dropForeignKeySql($p[0], $p[1]);
}


############# trigger ########################


/**
 * get information about database trigger
 *
 * @param array $p [0]=schema, [1]=triggername
 * @return array
 * @deprecated Use Dbf::getTriggerInformation instead.
 */
function dbf_3($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getTriggerInformation instead.');
	return Dbf::getTriggerInformation($p[0] ?? '', $p[1] ?? null);
}


/**
 * drop database trigger
 *
 * @param array $p [0]=triggername, [1]=tablename
 * @return string sql
 * @deprecated Use Dbf::dropTriggerSql instead.
 */
function dbq_10($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropTriggerSql instead.');
	return Dbf::dropTriggerSql($p[1], $p[0]);
}

/**
 * create trigger
 *
 * @param array $p [0]=schema, [1]=triggername, [2]=tablename, [3]=action, [4]=value, [5]=position
 * @return string sql
 * @deprecated Use Dbf::createTriggerSql instead.
 */
function dbq_13($p){
	//TODO: Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createTriggerSql instead.');
	return Dbf::createTriggerSql($p[0], $p[1], $p[2], $p[3], $p[4], $p[5]);
}

/**
 * limbas specific trigger function for limbas relation schema
 *
 * @param array $p [0]=schema, [1]=triggername, [2]=tablename, [3]=action, [4]=value
 * @return string sql
 * @deprecated Use Dbf::relationTriggerFunctionSql instead.
 */
function dbq_14($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::relationTriggerFunctionSql instead.');
	return Dbf::relationTriggerFunctionSql($p[0],$p[1], $p[2], $p[3], $p[4], $p[5], $p[6], intval($p[7]));
}

/**
 * limbas specific trigger function for lastmodified // not implemented
 *
 * @param array $p [0]=schema, [2]=tableid
 * @return string sql
 * @deprecated Use Dbf::lastModifiedTriggerFunctionSql instead.
 */
function dbq_27($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::lastModifiedTriggerFunctionSql instead.');
	return Dbf::lastModifiedTriggerFunctionSql($p[1]);
}

############# view ########################

/**
 * get view definition
 *
 * @param array $p [1]=viewname
 * @return string sql
 * @deprecated Use Dbf::getViewDefinitionSql instead.
 */
function dbq_8($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getViewDefinitionSql instead.');
	return Dbf::getViewDefinitionSql($p[0], $p[1]);
}

/**
 * existing views
 *
 * @param array $p [0]=schema, [1]=viewname
 * @return string sql
 * @deprecated Use Dbf::getExistingViewsSql instead.
 */
function dbq_12($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getExistingViewsSql instead.');
	return Dbf::getExistingViewsSql($p[0], $p[1] ?? null);
}

/**
 * create view
 *
 * @param array $p [0]=view name, [1]=definition
 * @return string sql
 * @deprecated Use Dbf::createViewSql instead.
 */
function dbq_19($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createViewSql instead.');
	return Dbf::createViewSql($p[0], $p[1]);
}

/**
 * drop view
 *
 * @param array $p [0]=view name
 * @return string sql
 * @deprecated Use Dbf::dropViewSql instead.
 */
function dbq_20($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropViewSql instead.');
	return Dbf::dropViewSql($p[0]);
}


############# tables ########################

/**
 * rename table
 *
 * @param array $p [0]=old tablename, [1]=new tablename
 * @return string sql
 * @deprecated Use Dbf::renameTableSql instead.
 */
function dbf_17($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::renameTableSql instead.');
	return Dbf::renameTableSql($p[0], $p[1]);
}

/**
 * list of tables / views
 *
 * @param array $p [0]=schema, [1]=name, [2]=typ
 * @return array
 * @deprecated Use Dbf::getTableList instead.
 */
function dbf_20($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getTableList instead.');
	return Dbf::getTableList($p[0], $p[1], $p[2]);
}

/**
 * drop table
 *
 * @param array $p [0]=table name
 * @return string sql
 * @deprecated Use Dbf::dropTableSql instead.
 */
function dbq_28($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropTableSql instead.');
	return Dbf::dropTableSql($p[0]);
}


############# SEQUENCE ########################

/**
 * get all sequences
 *
 * @param array $p [0]=schema
 * @deprecated Use Dbf::getSequences instead.
 */
function dbf_26($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getSequences instead.');
	return Dbf::getSequences($p[0], $p[1]);
}

/**
 * create sequence
 *
 * @param array $p [0]=schema, [1]=name, [2]=start
 * @deprecated Use Dbf::createSequence instead.
 */
function dbf_21($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createSequence instead.');
	return Dbf::createSequence($p[1], $p[2]);
}

/**
 * drop sequence
 *
 * @param array $p [0]=schema, [1]=name
 * @deprecated Use Dbf::dropSequence instead.
 */
function dbf_22($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropSequence instead.');
	return Dbf::dropSequence($p[1]);
}



############# columns ########################

/**
 * list of columns
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=fieldname, [3]=return $rs, [4]=get matview
 * @return string sql
 * @deprecated Use Dbf::getColumns instead.
 */
function dbf_5($p,$mode=null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::getColumns instead.');
	return Dbf::getColumns($p[0], $p[1], $p[2], $p[3], $p[4], $mode);
}

/**
 * modify column default
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=columnname, [3]=value
 * @return string sql
 * @deprecated Use Dbf::setColumnDefaultSql instead.
 */
function dbq_9($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::setColumnDefaultSql instead.');
	return Dbf::setColumnDefaultSql($p[0], $p[1], $p[2], $p[3]);
}


/**
 * rename column
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=old columnname, [3]=new columnname
 * @return string sql
 * @deprecated Use Dbf::renameColumnSql instead.
 */
function dbq_7($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::renameColumnSql instead.');
	return Dbf::renameColumnSql($p[0], $p[1], $p[2], $p[3]);
}

/**
 * modify column type
 *
 * @param array $p [0]=schema, [1]=tablename, [2]=columnname, [3]=value
 * @return string sql
 * @deprecated Use Dbf::modifyColumnTypeSql instead.
 */
function dbq_15($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::modifyColumnTypeSql instead.');
	return Dbf::modifyColumnTypeSql($p[1], $p[2], $p[3]);
}

/**
 * drop column
 *
 * @param array $p [0]=tablename, [1]=columnname
 * @return string sql
 * @deprecated Use Dbf::dropColumnSql instead.
 */
function dbq_22($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropColumnSql instead.');
	return Dbf::dropColumnSql($p[0], $p[1]);
}


/**
 * add column
 *
 * @param array $p [0]=schema,[1]=tablename, [2]=columnname, [3]=fieldtype, [4]=default
 * @return string sql
 * @deprecated Use Dbf::addColumnSql instead.
 */
function dbq_29($p){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::addColumnSql instead.');
	return Dbf::addColumnSql($p[1], $p[2], $p[3], $p[4]);
}


############# stored procedures ########################


/**
 * limbas based lmb_vkn procedure
 *
 * @param
 * @return string sql
 * @deprecated Use Dbf::createLimbasVknFunction instead.
 */
function dbq_16($p=null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createLimbasVknFunction instead.');
	return Dbf::createLimbasVknFunction($p[0] ?? '', $p[1] ?? false);
}


/**
 * drop limbas based lmb_vkn procedure
 *
 * @param
 *
 * @deprecated Use Dbf::dropLimbasVknFunction instead.
 */
function dbq_21($p = [], $t = null, $n = null){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::dropLimbasVknFunction instead.');
	Dbf::dropLimbasVknFunction($p[0], $t, $n);
}

/**
 * pretty print table size
 *
 * @param array $p [0]=schema, [1]=tablename
 * @return array table size, order size
 * @deprecated Use Dbf::prettyPrintTableSize instead.
 */
function dbq_30(array $p): array{
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::prettyPrintTableSize instead.');
	return Dbf::prettyPrintTableSize($p[0], $p[1]);
}



################# BACKUP #################


# -------- create Medium --------
/**
 * @param $path
 * @param $typ
 * @return bool
 * @deprecated Use Dbf::createMedium instead.
 */
function create_medium($path,$typ){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::createMedium instead.');
	return Dbf::createMedium($path, $typ);
}

# -------- delete medium --------
/**
 * @param $medium
 * @param $typ
 * @return bool
 * @deprecated Use Dbf::deleteMedium instead.
 */
function delete_medium($medium,$typ){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::deleteMedium instead.');
	return Dbf::deleteMedium($medium, $typ);
}

# -------- start backup --------
/**
 * @param $medium
 * @param $path
 * @param $typ
 * @return array
 * @deprecated Use Dbf::backupData instead.
 */
function backup_data($medium,$path,$typ){
	Log::deprecated('Method ' . __METHOD__ . ' is deprecated. Use Dbf::backupData instead.');
	return Dbf::backupData($medium,$path,$typ);
}

?>
